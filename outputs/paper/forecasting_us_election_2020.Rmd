---
title: "forecasting_election2020"
author: "Alen Mitrovski, Xiaoyan Yang, Matthew Wankiewicz"
date: "November 2nd, 2020"
abstract: |
  | First sentence. Second sentence. Third sentence. Fourth sentence.
  |
  | **Keywords:** Forecasting, US 2020 Election, Trump, Biden;
output:
  bookdown::pdf_document2:
    citation_package: natbib
toc: FALSE
bibliography: references.bib
---

```{r, echo=F, message=F, warning=F}
#install.packages("tidyverse")
library(tidyverse)
```

```{r}
# read in the polling data
polling <- readRDS("polling_data.rds")

# rename columns of polling data to match post-strat
polling <- polling %>% 
  rename(income_group = household_income,
         education_level = education)

# read in post-strat data 
post_strat <- readRDS("census_data.rds")
post_strat <- post_strat %>% 
  filter(race != "two major races", race != "three or more major races")
```

# Introduction

# Data

## Polling

We have used @citeR and @citeTidyverse so far

Data is from @citeIPUMS and from @citeVSG

```{r data, echo=F, message=F, warning=F}

# set up proportions and plots for polling data (variables we focus on)
gender <- polling %>% 
  group_by(sex) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

race <- polling %>% 
  group_by(race) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

income <- polling %>% 
  group_by(income_group) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

age <- polling %>% 
  group_by(age_groups) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

 statesicp <- polling %>% 
  group_by(stateicp) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

 education <- polling %>% 
  group_by(education_level) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

gender %>% ggplot(aes(sex, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

race %>% ggplot(aes(race, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

income %>% ggplot(aes(income_group, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

age %>% ggplot(aes(age_groups, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

statesicp %>% ggplot(aes(stateicp, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

education %>% ggplot(aes(education_level, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

# set up proportions for post-strat data

gender_post <- post_strat %>% 
  group_by(sex) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

race_post <- post_strat %>% 
  group_by(race) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

income_post <- post_strat %>% 
  group_by(income_group) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

age_post <- post_strat %>% 
  group_by(age_groups) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

statesicp_post <- post_strat %>% 
  group_by(stateicp) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

education_post <- post_strat %>% 
  group_by(education_level) %>% 
  summarise(n = n()) %>% 
  mutate(pct = n/sum(n))

gender_post %>% ggplot(aes(sex, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

race_post %>% ggplot(aes(race, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

income_post %>% ggplot(aes(income_group, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

age_post %>% ggplot(aes(age_groups, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

statesicp_post %>% ggplot(aes(stateicp, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)

education_post %>% ggplot(aes(education_level, pct)) +
  geom_point() + scale_y_continuous(labels = scales::percent)
```


# Model

```{r model, echo = F, message=F, warning=F}
model <- glm(vote_biden ~ sex + age_groups + race +
               stateicp + income_group + education_level, 
             data = polling, family = binomial())
broom::tidy(model)

x <- polling %>% 
  group_by(income_group) %>% 
  summarise(n = n())
y <- post_strat %>% 
  group_by(income_group) %>% 
  summarise(n = n())
```


# Results

```{r}
post_strat$estimate <- 
  model %>% 
  predict(newdata = post_strat)

post_strat %>% 
  mutate(biden_predict_prop = estimate*cell_prop_of_division_total) %>% 
  group_by(stateicp) %>% 
  summarise(biden_predict = sum(biden_predict_prop))

grouped <- post_strat %>% 
  group_by(sex, age_groups, race, income_group, stateicp, education_level) %>% 
  summarise(n = n()) %>% 
  mutate(prop_total = n/sum(n))
```


# Discussion

# References


